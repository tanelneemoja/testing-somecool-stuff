name: Generate Ad in Repo

on:
  # 1. Manual Trigger (Keep this for quick, controlled testing)
  workflow_dispatch: 
  
  # 2. Automated Trigger (Runs when specific files are pushed to the main branch)
  push:
    branches:
      - main # Or your default branch name (e.g., master)
    paths:
      - 'generate.py'
      - 'assets/**'
      - '.github/workflows/make_ad.yml'
      # Ignore the output directory so the Action's own commit doesn't trigger itself
      - '!generated_ads/**'
# Give the robot permission to write files back to your repo
permissions:
  contents: write

jobs:
  build-and-save:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Libraries (Pillow and requests)
        run: pip install Pillow requests

      - name: Run Generation Script
        # This will run generate.py and create the generated_ads folder
        run: python generate.py

      - name: Commit and Push Results
        # This will save the new images to the repo's generated_ads folder
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "actions@github.com"
          
          # Add the output folder
          git add generated_ads 
          
          # Commit only if there are changes (|| prevents error if no ads were generated)
          git commit -m "Automated ad generation run" || echo "No new ads to commit"
          git push
